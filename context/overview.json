{
  "projectName": "Coffee Shop Revenue Management Backend",
  "version": "1.0.0",
  "description": "A comprehensive NestJS backend service for managing a coffee shop's revenue with categories, products, orders, and revenue reporting capabilities",
  
  "technologyStack": {
    "framework": "NestJS 11.0.1",
    "language": "TypeScript 5.7.3",
    "database": "PostgreSQL",
    "orm": "TypeORM 0.3.27",
    "validation": "class-validator 0.14.2",
    "transformation": "class-transformer 0.5.1",
    "documentation": "Swagger/OpenAPI (@nestjs/swagger 11.2.1)",
    "runtime": "Node.js"
  },

  "modules": [
    {
      "name": "Categories",
      "path": "src/categories",
      "description": "Manage product categories",
      "entities": ["Category"],
      "endpoints": 5,
      "features": [
        "Create category",
        "Get all categories",
        "Get category by ID",
        "Update category",
        "Delete category (soft delete)"
      ]
    },
    {
      "name": "Products",
      "path": "src/products",
      "description": "Manage products with soft delete and category relationships",
      "entities": ["Product"],
      "endpoints": 5,
      "features": [
        "Create product",
        "Get all products (excludes soft-deleted)",
        "Get product by ID",
        "Update product",
        "Soft delete product"
      ]
    },
    {
      "name": "Orders",
      "path": "src/orders",
      "description": "Manage orders with lifecycle and order details",
      "entities": ["Order", "OrderDetail"],
      "endpoints": 6,
      "features": [
        "Create order with order details",
        "Get current user's order history",
        "Admin/staff listing with customer filter",
        "Get order by ID with ownership enforcement",
        "Update order status with role restrictions",
        "Cancel order with reason",
        "Award reward points when order is paid"
      ]
    },
    {
      "name": "Revenue",
      "path": "src/revenue",
      "description": "Generate revenue reports with payment method breakdown",
      "entities": [],
      "endpoints": 2,
      "features": [
        "Get daily revenue report",
        "Get revenue report by date range"
      ]
    },
    {
      "name": "Upload",
      "path": "src/upload",
      "description": "Handle secure file uploads for assets",
      "entities": ["FileUpload"],
      "endpoints": 4,
      "features": [
        "Upload product images",
        "List uploaded images",
        "Get single image metadata",
        "Delete image with file cleanup"
      ]
    },
    {
      "name": "Auth",
      "path": "src/auth",
      "description": "Authentication workflows with JWT access/refresh tokens",
      "entities": ["User"],
      "endpoints": 6,
      "features": [
        "User registration",
        "JWT login and logout",
        "Refresh token rotation",
        "Profile retrieval and update",
        "Password change with current password validation",
        "Bearer token guard for protected APIs"
      ]
    },
    {
      "name": "Users",
      "path": "src/users",
      "description": "User persistence, password hashing, and reward point storage",
      "entities": ["User"],
      "endpoints": 0,
      "features": [
        "Create user with hashed password",
        "Lookup by email or id",
        "Store refresh token hashes",
        "Reward point adjustments"
      ]
    },
    {
      "name": "Rewards",
      "path": "src/rewards",
      "description": "Reward point balance, history, and redemption",
      "entities": ["RewardTransaction"],
      "endpoints": 4,
      "features": [
        "Get current reward balance",
        "List reward history",
        "Redeem reward points with validation",
        "Expose available reward offers"
      ]
    },
    {
      "name": "Contact",
      "path": "src/contact",
      "description": "Customer contact requests and admin review",
      "entities": ["ContactMessage"],
      "endpoints": 2,
      "features": [
        "Submit public contact message",
        "Filter messages by status for staff"
      ]
    },
    {
      "name": "Stats",
      "path": "src/stats",
      "description": "Admin analytics dashboard data",
      "entities": [],
      "endpoints": 3,
      "features": [
        "Dashboard summary metrics",
        "Sales trend aggregation",
        "Top product leaderboard"
      ]
    }
  ],

  "sharedStructure": {
    "baseEntity": {
      "path": "src/common/entities/base.entity.ts",
      "description": "Abstract base class with common fields for all entities",
      "fields": [
        "id - Auto-generated primary key",
        "createdAt - Auto-generated timestamp",
        "updatedAt - Auto-updated timestamp",
        "createdBy - Audit trail (user ID)",
        "updatedBy - Audit trail (user ID)",
        "deletedAt - Soft delete support"
      ]
    },
    "enums": {
      "path": "src/enums",
      "description": "Centralized enum definitions",
      "files": [
        {
          "name": "product.enum.ts",
          "enums": [
            {
              "name": "ProductStatus",
              "values": ["active", "inactive"]
            }
          ]
        },
        {
          "name": "order.enum.ts",
          "enums": [
            {
              "name": "OrderStatus",
              "values": ["pending_payment", "paid", "cancelled"]
            },
            {
              "name": "PaymentMethod",
              "values": ["cash", "bank_transfer"]
            }
          ]
        }
      ]
    }
  },

  "databaseConfiguration": {
    "type": "PostgreSQL",
    "defaultPort": 5432,
    "defaultUsername": "postgres",
    "defaultDatabase": "coffee_shop",
    "synchronization": "Enabled in development (synchronize: true)",
    "entities": ["src/**/*.entity.ts"],
    "migrations": "Not configured yet"
  },

  "environmentVariables": {
    "required": [
      "DB_HOST - PostgreSQL database host (default: localhost)",
      "DB_PORT - PostgreSQL database port (default: 5432)",
      "DB_USERNAME - PostgreSQL database username (default: postgres)",
      "DB_PASSWORD - PostgreSQL database password",
      "DB_NAME - PostgreSQL database name (default: coffee_shop)",
      "NODE_ENV - Environment (development/production)",
      "PORT - Application port (default: 3000)",
      "JWT_ACCESS_SECRET - Secret used to sign access tokens",
      "JWT_REFRESH_SECRET - Secret used to sign refresh tokens",
      "JWT_ACCESS_EXPIRES_IN - Access token TTL (e.g., 15m)",
      "JWT_REFRESH_EXPIRES_IN - Refresh token TTL (e.g., 7d)"
    ],
    "configFile": ".env.example"
  },

  "apiDocumentation": {
    "framework": "Swagger/OpenAPI",
    "endpoint": "/api/docs",
    "url": "http://localhost:3000/api/docs",
    "features": [
      "Interactive API documentation",
      "Request/response schemas",
      "Example values for all DTOs",
      "Endpoint descriptions and tags",
      "Query parameter documentation",
      "Try-it-out functionality"
    ]
  },

  "keyFeatures": [
    "Complete CRUD operations for categories and products",
    "Order management with lifecycle (pending_payment → paid/cancelled)",
    "Authenticated customer workflows with JWT access/refresh tokens",
    "Soft delete for products (preserves data)",
    "Reward point accrual on paid orders and redemption handling",
    "Revenue reporting with daily and range-based analytics",
    "Dashboard statistics with sales trends and top product leaderboard",
    "Secure file upload with validation and database tracking",
    "Contact form submission with admin review capabilities",
    "Environment-based configuration and configurable JWT expiry",
    "Comprehensive API documentation with Swagger",
    "Input validation with class-validator",
    "Audit trail support (createdBy/updatedBy)",
    "PostgreSQL database with TypeORM",
    "Foreign key relationships with @JoinColumn decorators",
    "Eager loading for related entities",
    "Cascade delete for order details"
  ],

  "architecturalPatterns": [
    "Modular Monolith - Organized by feature modules",
    "RESTful API - Standard HTTP methods and status codes",
    "DTO Pattern - Data Transfer Objects for validation",
    "Repository Pattern - TypeORM repositories for data access",
    "Dependency Injection - NestJS built-in DI container",
    "Base Entity Pattern - Shared fields via abstract base class",
    "Enum Centralization - All enums in dedicated directory",
    "Soft Delete Pattern - Logical deletion via deletedAt field",
    "Eager Loading - Related entities loaded automatically where needed",
    "Cascade Operations - Automatic save/delete of related entities"
  ],

  "entityRelationships": {
    "Product → Category": {
      "type": "ManyToOne",
      "description": "Each product belongs to one category",
      "foreignKey": "categoryId",
      "joinColumn": "@JoinColumn({ name: 'categoryId' })",
      "eagerLoading": true
    },
    "Order → OrderDetail": {
      "type": "OneToMany",
      "description": "Each order has multiple order details (line items)",
      "relationshipField": "orderDetails",
      "cascade": true
    },
    "OrderDetail → Order": {
      "type": "ManyToOne",
      "description": "Each order detail belongs to one order",
      "foreignKey": "orderId",
      "joinColumn": "@JoinColumn({ name: 'orderId' })",
      "cascadeDelete": true
    },
    "OrderDetail → Product": {
      "type": "ManyToOne",
      "description": "Each order detail references one product",
      "foreignKey": "productId",
      "joinColumn": "@JoinColumn({ name: 'productId' })",
      "eagerLoading": true
    }
  },

  "developmentWorkflow": {
    "setup": [
      "1. Clone the repository",
      "2. Install dependencies: npm install",
      "3. Copy .env.example to .env and configure database credentials",
      "4. Ensure PostgreSQL is running",
      "5. Database will be auto-created and synchronized on first run"
    ],
    "commands": {
      "install": "npm install",
      "build": "npm run build",
      "start": "npm run start",
      "startDev": "npm run start:dev (with hot reload)",
      "startProd": "npm run start:prod",
      "test": "npm test",
      "testE2E": "npm run test:e2e",
      "lint": "npm run lint",
      "format": "npm run format"
    },
    "accessPoints": {
      "api": "http://localhost:3000",
      "swagger": "http://localhost:3000/api/docs"
    }
  },

  "contextDocumentation": {
    "purpose": "Provide comprehensive documentation for AI-assisted development",
    "entryPoint": "context/main.json",
    "guide": "CONTEXT_SYSTEM_GUIDE.md",
    "files": [
      "context/main.json - Project overview and entry point",
      "context/overview.json - High-level architecture (this file)",
      "context/category.json - Categories module documentation",
      "context/product.json - Products module documentation",
      "context/order.json - Orders module documentation",
      "context/revenue.json - Revenue module documentation"
    ],
    "usage": "AI agents should read main.json first, then consult module-specific context files for detailed information"
  },

  "totalEndpoints": 37,
  "totalEntities": 8,
  "buildStatus": "Success",
  "lastUpdated": "2025-10-25"
}

