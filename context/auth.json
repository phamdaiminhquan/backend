{
  "moduleName": "Auth",
  "path": "src/auth",
  "purpose": "Handle user authentication, JWT token lifecycle, and profile management",
  "dtos": {
    "register": {
      "path": "src/auth/dto/register.dto.ts",
      "fields": [
        { "name": "email", "type": "string", "validators": ["@IsEmail()"], "required": true },
        { "name": "password", "type": "string", "validators": ["@IsString()", "@MinLength(6)"], "required": true },
        { "name": "fullName", "type": "string", "validators": ["@IsString()", "@MinLength(1)"], "required": true },
        { "name": "phone", "type": "string", "validators": ["@IsOptional()", "@IsString()"], "required": false }
      ]
    },
    "login": {
      "path": "src/auth/dto/login.dto.ts",
      "fields": [
        { "name": "email", "type": "string", "validators": ["@IsEmail()"], "required": true },
        { "name": "password", "type": "string", "validators": ["@IsString()", "@MinLength(6)"], "required": true }
      ]
    },
    "refresh": {
      "path": "src/auth/dto/refresh-token.dto.ts",
      "fields": [
        { "name": "refreshToken", "type": "string", "validators": ["@IsString()", "@MinLength(10)"] }
      ]
    },
    "updateProfile": {
      "path": "src/auth/dto/update-profile.dto.ts",
      "fields": [
        { "name": "fullName", "type": "string", "validators": ["@IsOptional()", "@IsString()", "@MinLength(1)"] },
        { "name": "phone", "type": "string", "validators": ["@IsOptional()", "@IsString()"] },
        { "name": "currentPassword", "type": "string", "validators": ["@ValidateIf(o => Boolean(o.newPassword))", "@IsString()", "@MinLength(6)"] },
        { "name": "newPassword", "type": "string", "validators": ["@IsOptional()", "@IsString()", "@MinLength(6)"] }
      ]
    }
  },
  "guards": {
    "jwt": {
      "path": "src/auth/guards/jwt-auth.guard.ts",
      "description": "Wraps Passport jwt strategy to protect endpoints requiring authentication"
    }
  },
  "strategies": {
    "jwt": {
      "path": "src/auth/strategies/jwt.strategy.ts",
      "description": "Validates access tokens, loads user, and strips sensitive fields"
    }
  },
  "endpoints": [
    {
      "method": "POST",
      "path": "/auth/register",
      "description": "Register a new customer account",
      "requestBody": "RegisterDto",
      "responseBody": "{ user, tokens }",
      "statusCode": 201,
      "validation": ["Email must be unique", "Password stored as bcrypt hash"]
    },
    {
      "method": "POST",
      "path": "/auth/login",
      "description": "Authenticate user and issue JWT access/refresh token pair",
      "requestBody": "LoginDto",
      "responseBody": "{ user, tokens }",
      "statusCode": 200,
      "errors": ["401 - Invalid credentials"]
    },
    {
      "method": "POST",
      "path": "/auth/refresh-token",
      "description": "Exchange a valid refresh token for new access/refresh tokens",
      "requestBody": "RefreshTokenDto",
      "responseBody": "AuthTokens",
      "statusCode": 200,
      "errors": ["401 - Invalid refresh token"]
    },
    {
      "method": "POST",
      "path": "/auth/logout",
      "description": "Invalidate the stored refresh token for the current user",
      "statusCode": 200,
      "security": ["Bearer"],
      "responseBody": "{ message: string }"
    },
    {
      "method": "GET",
      "path": "/auth/profile",
      "description": "Get current user profile",
      "statusCode": 200,
      "security": ["Bearer"],
      "responseBody": "Sanitized user"
    },
    {
      "method": "PUT",
      "path": "/auth/profile",
      "description": "Update profile and optionally change password",
      "requestBody": "UpdateProfileDto",
      "statusCode": 200,
      "security": ["Bearer"],
      "validation": ["New password requires current password"]
    }
  ],
  "businessRules": [
    "Emails are stored in lowercase and must be unique",
    "Passwords are hashed with bcrypt; plain text never stored",
    "Refresh tokens are hashed before persistence and rotated on every login/refresh",
    "Access token secret/expiry sourced from environment variables",
    "Profile updates require current password when setting a new password"
  ],
  "dependencies": ["Users Module"],
  "usedBy": ["Orders Module", "Rewards Module", "Contact Module", "Stats Module"],
  "files": {
    "controller": "src/auth/auth.controller.ts",
    "service": "src/auth/auth.service.ts",
    "module": "src/auth/auth.module.ts",
    "dtos": "src/auth/dto/",
    "guards": "src/auth/guards/jwt-auth.guard.ts",
    "strategies": "src/auth/strategies/jwt.strategy.ts"
  }
}
