---
applyTo: 'src/orders/**'
---

# Orders Module Instructions

## Business Rules
- Check product inventory before creating order
- Calculate total price from order items
- Use `OrderStatus` enum (PENDING, CONFIRMED, DELIVERING, COMPLETED, CANCELLED)
- Update product inventory after order confirmation

## Coding Standards
- Orders must have customer relationship
- Order items stored in separate entity with relations
- Use transactions for order creation (inventory + order + items)
- Include price snapshot in order items (don't rely on current product price)

## Security
- Users can only view their own orders (except admin)
- Validate user ownership before update/cancel

## Status Transitions
- PENDING → CONFIRMED → DELIVERING → COMPLETED
- Can cancel only if status is PENDING or CONFIRMED
